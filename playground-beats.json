{
  "$schema": "https://playground.wordpress.net/blueprint-schema.json",
  "landingPage": "/",
  "preferredVersions": {
    "php": "8.2",
    "wp": "6.8"
  },
  "steps": [
    {
      "step": "unzip",
      "zipFile": {
        "resource": "url",
        "url": "https://raw.githubusercontent.com/crystalthedeveloper/wordpress-beats-playground/main/assets/beats-upload-player.zip",
        "caption": "Bundling Beats Upload Player"
      },
      "extractToPath": "/wordpress/wp-content/plugins/"
    },
    {
      "step": "defineWpConfigConsts",
      "consts": {
        "WP_ENVIRONMENT_TYPE": "playground",
        "WP_PLAYGROUND": true,
        "IS_PLAYGROUND": true
      }
    },
    {
      "step": "activatePlugin",
      "pluginPath": "beats-upload-player/beats-upload-player.php"
    },
    {
      "step": "activateTheme",
      "themeFolderName": "twentytwentyfive"
    },
    {
      "step": "runPHP",
      "code": "require_once ABSPATH . 'wp-admin/includes/post.php';\nrequire_once ABSPATH . 'wp-admin/includes/theme.php';\nrequire_once ABSPATH . 'wp-admin/includes/template.php';\n\nerror_log('[Beats Blueprint] runPHP start');\n\nif ( ! function_exists( 'beats_normalize_block_markup' ) ) {\n    function beats_normalize_block_markup( $markup ) {\n        if ( function_exists( 'parse_blocks' ) && function_exists( 'serialize_blocks' ) ) {\n            $blocks = parse_blocks( $markup );\n            if ( ! empty( $blocks ) ) {\n                return serialize_blocks( $blocks );\n            }\n        }\n        return $markup;\n    }\n}\n\nif ( function_exists( 'beats_prime_data' ) ) {\n    beats_prime_data();\n} elseif ( function_exists( 'beats_seed_playground_demo' ) ) {\n    beats_seed_playground_demo();\n}\n\n$beats_content = <<<'HTML'\n<!-- wp:group {\"tagName\":\"main\",\"align\":\"full\"} -->\n<main class=\"wp-block-group alignfull\">\n<!-- wp:beats/visualizer /-->\n<!-- wp:html -->\n<div id=\"beats-wrapper\" class=\"beats-wrapper\" style=\"padding-left:20px;padding-right:0;\">\n<!-- /wp:html -->\n<!-- wp:paragraph {\"align\":\"center\"} -->\n<p class=\"has-text-align-center\">Preview the Beats library and player below.</p>\n<!-- /wp:paragraph -->\n<!-- wp:beats/category-search /-->\n<!-- wp:group {\"align\":\"full\",\"style\":{\"spacing\":{\"blockGap\":\"16px\"}},\"layout\":{\"type\":\"flex\",\"orientation\":\"vertical\"}} -->\n<div class=\"wp-block-group alignfull\" style=\"gap:16px\">\n<!-- wp:beats/display-home /-->\n<!-- wp:beats/global-player /-->\n</div>\n<!-- /wp:group -->\n<!-- wp:html -->\n</div>\n<!-- /wp:html -->\n</main>\n<!-- /wp:group -->\nHTML;\n$beats_content = beats_normalize_block_markup( $beats_content );\n\n$page_args = array(\n    'post_title'   => 'Beats Demo',\n    'post_name'    => 'beats-demo',\n    'post_status'  => 'publish',\n    'post_type'    => 'page',\n    'post_content' => $beats_content,\n    'post_author'  => get_current_user_id() ?: 1\n);\n\n$existing_page = get_page_by_path( 'beats-demo' );\nif ( $existing_page ) {\n    $page_args['ID'] = $existing_page->ID;\n}\n\n$page_id = wp_insert_post( $page_args, true );\nif ( is_wp_error( $page_id ) ) {\n    error_log('[Beats Blueprint] Failed to create Beats Demo page: ' . $page_id->get_error_message());\n    echo 'Failed to create Beats Demo page: ' . $page_id->get_error_message() . PHP_EOL;\n} else {\n    update_option( 'show_on_front', 'page' );\n    update_option( 'page_on_front', $page_id );\n    update_option( 'page_for_posts', 0 );\n    echo 'Beats Demo front page ready (post ID ' . $page_id . ').' . PHP_EOL;\n}\n\n$upload_content = <<<'HTML'\n<!-- wp:group {\"tagName\":\"main\",\"align\":\"full\"} -->\n<main class=\"wp-block-group alignfull\">\n<!-- wp:paragraph {\"align\":\"center\"} -->\n<p class=\"has-text-align-center\">Share a new beat with the Playground uploader.</p>\n<!-- /wp:paragraph -->\n<!-- wp:beats/upload-form /-->\n</main>\n<!-- /wp:group -->\nHTML;\n$upload_content = beats_normalize_block_markup( $upload_content );\n\n$upload_args = array(\n    'post_title'   => 'Upload',\n    'post_name'    => 'upload',\n    'post_status'  => 'publish',\n    'post_type'    => 'page',\n    'post_content' => $upload_content,\n    'post_author'  => get_current_user_id() ?: 1\n);\n\n$existing_upload = get_page_by_path( 'upload' );\nif ( $existing_upload ) {\n    $upload_args['ID'] = $existing_upload->ID;\n}\n\n$upload_id = wp_insert_post( $upload_args, true );\nif ( is_wp_error( $upload_id ) ) {\n    error_log('[Beats Blueprint] Failed to prepare Upload page: ' . $upload_id->get_error_message());\n} else {\n    echo 'Upload page ready (post ID ' . $upload_id . ').' . PHP_EOL;\n}\n\nupdate_option( 'blogname', 'Beats' );\nerror_log('[Beats Blueprint] runPHP complete');\n"
    }
  ]
}
